<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>ELK集群搭建 | 大数据创新中心</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="使用ElasticSearch+Logstash+Kibana搭建分布式数据管理分析平台"><meta name=generator content="Hugo 0.64.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css rel=stylesheet><meta property="og:title" content="ELK集群搭建"><meta property="og:description" content="使用ElasticSearch+Logstash+Kibana搭建分布式数据管理分析平台"><meta property="og:type" content="article"><meta property="og:url" content="https://yulongbb.cn/post/elk%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><meta property="article:published_time" content="2021-01-08T15:58:55+08:00"><meta property="article:modified_time" content="2021-01-08T15:58:55+08:00"><meta itemprop=name content="ELK集群搭建"><meta itemprop=description content="使用ElasticSearch+Logstash+Kibana搭建分布式数据管理分析平台"><meta itemprop=datePublished content="2021-01-08T15:58:55+08:00"><meta itemprop=dateModified content="2021-01-08T15:58:55+08:00"><meta itemprop=wordCount content="333"><meta itemprop=keywords content="ElasticSearch,Logstash,Kibana,"><meta name=twitter:card content="summary"><meta name=twitter:title content="ELK集群搭建"><meta name=twitter:description content="使用ElasticSearch+Logstash+Kibana搭建分布式数据管理分析平台"></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://yulongbb.cn/images/ELK%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA.png)><div class="pb3-m pb6-l bg-black-60"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">大数据创新中心</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="关于 page">关于</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/post/ title="文章 page">文章</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/contact/ title="联系我 page">联系我</a></li></ul></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><h1 class="f2 f1-l fw2 white-90 mb0 lh-title">ELK集群搭建</h1><h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">使用ElasticSearch+Logstash+Kibana搭建分布式数据管理分析平台</h2></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">文章</aside><h1 class="f1 athelas mt3 mb1">ELK集群搭建</h1><p class=tracked>By <strong>玉龙BB</strong></p><time class="f6 mv4 dib tracked" datetime=2021-01-08T15:58:55+08:00>January 8, 2021</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h2 id=介绍>介绍</h2><p><code>ELK</code>是三个开源项目的首字母缩写，这三个项目分别是：Elasticsearch、Logstash 和 Kibana。</p><p>Elasticsearch 是一个搜索和分析引擎。一个ElasticSearch集群由一个或多个节点(Node)组成，每个集群都有一个共同的集群名称作为标识。一个ElasticSearch实例即一个Node，一台机器可以有多个实例，正常使用下每个实例应该会部署在不同机器上。ElasticSearch的配置文件中可以通过node.master、node.data来设置节点类型。node.master：表示节点是否具有称为主节点的资格。node.data：表示节点是否存储数据。</p><p>Logstash 是服务器端数据处理管道，能够同时从多个来源采集数据，转换数据，然后将数据发送到诸如 Elasticsearch 等“存储库”中。</p><p>Kibana 则可以让用户在 Elasticsearch 中使用图形和图表对数据进行可视化。</p><h2 id=步骤>步骤</h2><h3 id=1准备三台服务器>1:准备三台服务器</h3><table><thead><tr><th>服务器</th><th>角色</th></tr></thead><tbody><tr><td>192.168.101.103</td><td>node-1</td></tr><tr><td>192.168.101.104</td><td>node-2</td></tr><tr><td>192.168.101.105</td><td>node-3</td></tr></tbody></table><h3 id=2安装elasticsearch>2:安装Elasticsearch</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 分别将Elasticsearch安装包拷贝到三台服务器上</span>
scp elasticsearch-6.6.2.tar.gz root@192.168.101.103:/usr/setups/
scp elasticsearch-6.6.2.tar.gz root@192.168.101.104:/usr/setups/
scp elasticsearch-6.6.2.tar.gz root@192.168.101.105:/usr/setups/
<span style=color:#75715e># 解压</span>
tar -xzvf elasticsearch-6.6.2.tar.gz
<span style=color:#75715e># 移动安装目录</span>
mv elasticsearch-6.6.2 /usr/program/
<span style=color:#75715e># 创建数据目录</span>
mkdir -p /opt/elasticsearch-6.6.2/data
mkdir -p /opt/elasticsearch-6.6.2/logs
</code></pre></div><h3 id=3修改配置文件>3:修改配置文件</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># ---------------------------------- Cluster -----------------------------------</span>
<span style=color:#75715e>#集群名称</span>
<span style=color:#66d9ef>cluster.name</span>: elasticsearch-cluster
<span style=color:#75715e># ------------------------------------ Node ------------------------------------</span>
<span style=color:#75715e>#节点名称</span>
<span style=color:#66d9ef>node.name</span>: node<span style=color:#ae81ff>-1</span> 
<span style=color:#75715e>#是不是有资格主节点</span>
<span style=color:#66d9ef>node.master</span>: <span style=color:#66d9ef>true</span>
<span style=color:#75715e>#是否存储数据</span>
<span style=color:#66d9ef>node.data</span>: <span style=color:#66d9ef>true</span>
<span style=color:#75715e>#最⼤集群节点数</span>
<span style=color:#66d9ef>node.max_local_storage_nodes</span>: <span style=color:#ae81ff>3</span> 
<span style=color:#75715e># ----------------------------------- Paths ------------------------------------</span>
<span style=color:#75715e>#数据和存储路径</span>
<span style=color:#66d9ef>path.data</span>:  /opt/elasticsearch<span style=color:#ae81ff>-6.6</span><span style=color:#ae81ff>.2</span>/data
<span style=color:#66d9ef>path.logs</span>:  /opt/elasticsearch<span style=color:#ae81ff>-6.6</span><span style=color:#ae81ff>.2</span>/logs
<span style=color:#75715e># ---------------------------------- Network -----------------------------------</span>
<span style=color:#75715e>#⽹关地址</span>
<span style=color:#66d9ef>network.host</span>: <span style=color:#ae81ff>0.0</span><span style=color:#ae81ff>.0</span><span style=color:#ae81ff>.0</span>
<span style=color:#75715e>#端⼝</span>
<span style=color:#66d9ef>http.port</span>: <span style=color:#ae81ff>9200</span>
<span style=color:#75715e>#内部节点之间沟通端⼝</span>
<span style=color:#66d9ef>transport.tcp.port</span>: <span style=color:#ae81ff>9300</span>
<span style=color:#75715e># --------------------------------- Discovery ----------------------------------</span>
<span style=color:#75715e>#写⼊候选主节点的设备地址，在开启服务后可以被选为主节点</span>
<span style=color:#66d9ef>discovery.zen.ping.unicast.hosts</span>: [<span style=color:#e6db74>&#34;192.168.101.103:9300&#34;</span>, <span style=color:#e6db74>&#34;192.168.101.104:9300&#34;</span>, <span style=color:#e6db74>&#34;192.168.101.105:9300&#34;</span>]
<span style=color:#66d9ef>discovery.zen.minimum_master_nodes</span>: <span style=color:#ae81ff>3</span>

<span style=color:#66d9ef>bootstrap.system_call_filter</span>: <span style=color:#66d9ef>false</span>
<span style=color:#66d9ef>http.cors.allow-origin</span>: <span style=color:#e6db74>&#34;*&#34;</span>
<span style=color:#66d9ef>http.cors.enabled</span>: <span style=color:#66d9ef>true</span>
<span style=color:#66d9ef>http.cors.allow-headers </span>: X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization
<span style=color:#66d9ef>http.cors.allow-credentials</span>: <span style=color:#66d9ef>true</span>

</code></pre></div><h3 id=4-运行>4: 运行</h3><p>文件句柄太少，至少要65536</p><p>编辑配置 vi /etc/security/limits.conf</p><ul><li>soft nofile 65536</li><li>hard nofile 131072</li><li>soft nproc 2048</li><li>hard nproc 4096
虚拟内存太少，至少262144</li></ul><p>编辑配置 vi /etc/sysctl.conf</p><p>vm.max_map_count=655360
激活配置 sysctl -p</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 创建用户</span>
adduser elasticsearch
<span style=color:#75715e># 设置密码</span>
passwd elasticsearch
<span style=color:#75715e># 授权</span>
chown -R elasticsearch /usr/program/elasticsearch-6.6.2
chown -R elasticsearch /opt/elasticsearch-6.6.2
<span style=color:#75715e># 切换用户</span>
su elasticsearch
<span style=color:#75715e># 运行</span>
./elasticsearch -d
</code></pre></div><p>查看集群状态 http://192.168.101.103:9200/_cat/health?v</p><h3 id=5-安装kibana>5: 安装Kibana</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 上传文件到服务器</span>
scp kibana-6.6.2-linux-x86_64.tar.gz root@192.168.101.103:/usr/setups/
<span style=color:#75715e># 解压</span>
tar -xzvf kibana-6.6.2-linux-x86_64.tar.gz
<span style=color:#75715e># 移动安装目录</span>
mv kibana-6.6.2-linux-x86_64 /usr/program/
</code></pre></div><h3 id=6-修改配置>6: 修改配置</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>server.port</span>: <span style=color:#ae81ff>5601</span>
<span style=color:#66d9ef>server.host</span>: <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>
<span style=color:#66d9ef>elasticsearch.hosts</span>: [<span style=color:#e6db74>&#34;http://192.168.101.103:9200&#34;</span>, <span style=color:#e6db74>&#34;http://192.168.101.104:9200&#34;</span>, <span style=color:#e6db74>&#34;http://192.168.101.105:9200&#34;</span>]
</code></pre></div><h3 id=7-启动>7: 启动</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nohup ./bin/kibana
</code></pre></div><h3 id=8-安装logstash>8: 安装Logstash</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 上传文件到服务器</span>
scp logstash-6.6.2.tar.gz root@192.168.101.103:/usr/setups/
<span style=color:#75715e># 解压</span>
tar -xzvf logstash-6.6.2.tar.gz
<span style=color:#75715e># 移动安装目录</span>
mv logstash-6.6.2 /usr/program/
</code></pre></div><h3 id=9-测试logstash是否安装成功>9: 测试Logstash是否安装成功</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>bin/logstash -e <span style=color:#e6db74>&#39;input { stdin { } } output { stdout {} }&#39;</span>
</code></pre></div><h3 id=10-配置logstash输出到elasticsearch>10: 配置logstash输出到elasticsearch</h3><pre><code class=language-conf data-lang=conf>input {
  beats {
    port =&gt; 5044
  }
}

output {
  elasticsearch {
    hosts =&gt; [&quot;http://192.168.101.103:9200&quot;, &quot;http://192.168.101.104:9200&quot;, &quot;http://192.168.101.105:9200&quot;]
    index =&gt; &quot;%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}&quot;
  }
}
</code></pre><h3 id=11-启动>11: 启动</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./bin/logstash -f config/logstash-sample.conf &gt;logstash.log  2&gt;&amp;<span style=color:#ae81ff>1</span> &amp;
</code></pre></div><h3 id=12安装filebeat>12：安装Filebeat</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 上传文件到服务器</span>
scp filebeat-6.6.2-linux-x86_64.tar.gz root@192.168.101.91:/usr/setups/
<span style=color:#75715e># 解压</span>
tar -xzvf filebeat-6.6.2-linux-x86_64.tar.gz
<span style=color:#75715e># 移动安装目录</span>
mv filebeat-6.6.2-linux-x86_64 /usr/program/
</code></pre></div><h3 id=13-修改配置文件>13: 修改配置文件</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e>#=========================== Filebeat inputs =============================</span>
- <span style=color:#66d9ef>type</span>: log
  <span style=color:#66d9ef>enabled</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#66d9ef>paths</span>:
    - /var/log/kgms/<span style=color:#75715e>*.log</span>
<span style=color:#75715e>#================================ Outputs =====================================</span>
<span style=color:#75715e>#----------------------------- Logstash output --------------------------------</span>
<span style=color:#66d9ef>output.logstash</span>:
  <span style=color:#66d9ef>hosts</span>: [<span style=color:#e6db74>&#34;192.168.101.103:5044&#34;</span>]
</code></pre></div><h3 id=14-启动>14: 启动</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo ./filebeat -e &gt;filebeat.log 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp;
</code></pre></div><h2 id=链接>链接</h2><p><a href=https://www.cnblogs.com/chenyanbin/p/13493920.html>ElasticSearch 7.8.1集群搭建</a></p><p><a href=https://blog.csdn.net/weixin_41947378/article/details/109384397>Elasticsearch安装、集群搭建、kibana安装</a></p><h2 id=资源>资源</h2><p><a href=https://pan.baidu.com/s/1Z_fxdw7y9r5dXCv6K3K5VQ>kibana-6.6.2-linux-x86_64.tar</a> 提取码：1111</p><p><a href=https://pan.baidu.com/s/126nVsnY0XorU6cO9aJZsCg>elasticsearch-6.6.2.tar</a> 提取码：1111</p><p><a href=https://pan.baidu.com/s/1r6TaB6g3Ly55_vm5FmNfmQ>logstash-6.6.2.tar</a> 提取码：1111</p><p><a href=https://pan.baidu.com/s/1qR-c5a7l0XjaRseX7POmDA>filebeat-6.6.2-linux-x86_64.tar</a> 提取码：1111</p><ul class=pa0><li class=list><a href=/tags/elasticsearch class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">ElasticSearch</a></li><li class=list><a href=/tags/logstash class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Logstash</a></li><li class=list><a href=/tags/kibana class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Kibana</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://yulongbb.cn/>&copy; 大数据创新中心 2021</a><div></div></div></footer><script src=/dist/js/app.3fc0f988d21662902933.js></script></body></html>